# tree-sitter-sdevice 编码规范

## 1. 总体原则

*   **一致性**：保持代码风格、命名和结构的一致性，尤其是在整个语法文件和相关工具代码中。
*   **可读性**：编写清晰、易懂的代码，便于他人理解和维护。
*   **模块化**：将语法规则分解为小的、可重用的模块，提高可维护性。
*   **准确性**：确保语法解析器能准确地解析 sdevice 文件的所有有效语法，并能有效地报告语法错误。

## 2. 语法文件 (`grammar.js`) 规范

### 2.1 规则命名

*   **小写下划线蛇形命名法 (snake_case)**：对于所有规则（包括非终结符和终结符），使用小写下划线蛇形命名法。例如：`device_block`, `material_property`, `statement_list`, `keyword_device`, `operator_assign`。
*   **描述性名称**：规则名称应清晰地描述其解析的内容。

### 2.2 规则定义

*   **明确的结构**：使用 `seq`, `choice`, `optional`, `repeat`, `prec` 等 Tree-sitter 内置函数清晰地定义语法结构。
*   **优先级 (Precedence)**：对于存在歧义的语法结构，务必使用 `prec` 来明确解析优先级。例如，数学表达式的运算符优先级。
*   **外部 Scanner (External Scanner)**：如果需要处理复杂的词法分析（例如，不规则的字符串、注释或预处理指令），考虑使用外部 scanner。
*   **别名 (Aliases)**：使用 `alias` 为复杂的规则提供更具可读性的名称，尤其是在错误报告中。

### 2.3 注释

*   **解释复杂规则**：为复杂或不直观的语法规则添加注释，解释其目的和工作原理。
*   **引用官方文档**：如果可能，在注释中引用 Sentaurus TCAD sdevice 语法的官方文档或规范，以便于验证。

### 2.4 令牌 (Tokens)

*   **最小化歧义**：设计令牌时，尽量减少词法分析阶段的歧义。
*   **关键字与标识符**：确保关键字被正确识别，并且不会被误识别为普通标识符。使用 `token.immediate` 或 `$._reserved` 等机制处理。

## 3. 测试规范

*   **全面的测试用例**：编写覆盖 sdevice 文件各种合法和非法语法的测试用例。
*   **结构化测试文件**：将测试用例组织在易于导航的目录结构中，例如按功能或语法特性分类。
*   **预期 AST (Abstract Syntax Tree)**：为每个测试用例提供预期的 AST 结构，以便验证解析器的正确性。
*   **错误恢复测试**：编写测试用例，验证解析器在遇到语法错误时的错误恢复能力。

## 4. 文档规范

*   **README.md**：在项目的 `README.md` 文件中提供项目的目的、安装、使用方法和任何已知限制。
*   **语法高亮示例**：提供 sdevice 文件的语法高亮示例，展示解析器的效果。
*   **贡献指南**：如果项目接受贡献，提供一份贡献指南，解释如何提交更改、运行测试等。

## 5. 版本控制

*   **语义化版本 (Semantic Versioning)**：遵循语义化版本控制规范 (MAJOR.MINOR.PATCH)。
*   **有意义的提交信息**：使用清晰、简洁且有意义的提交信息，说明每次提交的目的。